---
title: "직업별 월급 차이"
author: 박세화
date: July 31, 2020
output: github_document
---


```{r, include=F}
library(foreign)             # SPSS 파일 로드
library(dplyr)               # 전처리
library(ggplot2)             # 시각화
library(readxl)              # 엑셀 파일 불러오기

# 데이터 불러오기
raw_welfare <- read.spss(file = "Koweps_hpc10_2015_beta1.sav",
                         to.data.frame = T)

# 복사본 만들기
welfare <- raw_welfare

# 변수 이름 변경하기기
welfare <- rename(welfare,
                  sex = h10_g3,            # 성별
                  birth = h10_g4,          # 태어난 연도
                  marriage = h10_g10,      # 혼인 상태
                  religion = h10_g11,      # 종교
                  income = p1002_8aq1,     # 월급
                  code_job = h10_eco9,     # 직종 코드
                  code_region = h10_reg7)  # 지역 코드

# birth 이상치 결측 처리
welfare$birth <- ifelse(welfare$birth==9999,NA,welfare$birth)

# sex 이상치 결측 처리
welfare$income <- ifelse(welfare$income %in% c(0,9999),NA,welfare$income)

# age 파생변수 만들기
welfare$age <- 2015- welfare$birth +1

#ageg 파생변수 만들기
welfare <- welfare %>% 
  mutate(ageg=ifelse(age<30,"young",ifelse(age<60,"middle","old")))

# sex 값 이름 변경
welfare$sex <- ifelse(welfare$sex==1,"male","female")

```

## 6. 직업별 월급 차이
직업별 월급 차이 분석을 위해 직업 변수를 검토하고 전처리한다.

### 분석 절차
- 1단계 : 변수 검토 및 전처리 (직업, 월급)
- 2단계 : 변수 간 관계 분석 (직업별 월급 평균표 만들기, 그래프 만들기)

### 직업 변수 검토 및 전처리하기

#### 1. 변수 검토하기
직업을 나타낸 code_job 변수를 살펴본다.

```{r, results="hide"}
class(welfare$code_job)

table(welfare$code_job)
```

#### 2. 전처리
직업분류코드 목록을 이용해 숫자로 되어 있는 code_job 변수를 직업의 명칭으로 된 변수로 만든다.
Koweps_Codebook.xlsx를 이용해 첫 행을 변수명으로 가져오도록 설정하고, 엑셀 파일의 두 번째 시트에 있는 직업분류코드 목록을 불러온다.

```{r, results="markup"}
list_job <- read_excel("Koweps_Codebook.xlsx",col_names = T,sheet = 2)

head(list_job)

dim(list_job)
```

이를 통해 직업 명칭으로 된 list_job 변수를 생성하고, 직업이 149개로 분류된다는 것을 확인했다.

#### 3. data frame 결합하기
left_join()으로 job 변수를 welfare에 code_job을 기준으로 결합한다.
```{r,results="markup"}
welfare <- left_join(welfare,list_job,id="code_job")

welfare %>% 
  filter(!is.na(code_job)) %>% 
  select(code_job,job) %>% 
  head(10)
```


### 직업별 월급 차이 분석하기

#### 1. 직업별 월급 평균표 만들기
직업이나 월급이 없는 사람은 분석 대상이 아니므로 제외하고 직업별 월급 평균을 구한다.

```{r, results="markup"}
job_income <- welfare %>% 
  filter(!is.na(job)&!is.na(income)) %>% 
  group_by(job) %>% 
  summarise(mean_income=mean(income))

head(job_income)

```

#### 2. 상위 10개 추출
어떤 직업의 월급이 많은지 알아보기 쉽도록 월급을 내림차순으로 정렬하고 상위 10개를 추출한다.

```{r, results="markup"}
top10 <- job_income %>% 
  arrange(desc(mean_income)) %>% 
  head(10)

top10
```

#### 3. 그래프 만들기
표를 이용해 월급 상위 10개 직업 그래프를 만든다.
직업 이름이 길기 때문에 막대를 오른쪽으로 90도 회전시킨 그래프를 만든다.

```{r, results="markup"}
ggplot(data=top10,aes(x=reorder(job,mean_income),y=mean_income))+
  geom_col()+
  coord_flip()
```

표와 그래프를 통해 '금속 재료 공학 기술자 및 시험원'이 평균 845만원으로 가장 많은 월급을 받고, 다음으로 '의로진료 전문가'가 평균 844만원, '의회의원 고위공무원 및 공공단체임원'이 평균 750만원으로 많은 월급을 받고 있음을 알 수 있다.

#### 4. 하위 10위 추출
이번에는 반대로 어떤 직업이 월급이 적은지 알아보기 위해 월급을 오름차순으로 정렬하여 하위 10개를 추출한다.

```{r, results="markup"}
bottom10 <- job_income %>% 
  arrange(mean_income) %>% 
  head(10)

bottom10

```

#### 5. 그래프 만들기
표를 이용해 월급 하위 10개 직업 그래프를 만든다.
월급 상위 10개 직업 그래프와 마찬가지로 직업 이름이 길기 때문에 막대를 오른쪽으로 90도 회전시킨 그래프를 만든다.
월급 상위 10개 직업 그래프와 함께 살펴볼 수 있도록 y축의 범위를 0부터 850까지로 조정한다.

```{r,results="markup"}
ggplot(data=bottom10,aes(x=reorder(job,-mean_income),y=mean_income))+
  geom_col()+
  coord_flip()+
  ylim(0,850)

```

표와 그래프를 통해 '가사 및 육아 도우미'의 월급이 평균 80만원으로 가장 적고, 다음으로 '임업관련 종사자'가 평균 83만원, '기타 서비스관련 단순 종사원'이 평균 88만원의 순으로 월급이 적다는 것을 확인할 수 있다. 

또한 가장 많은 월급을 받는 '금속 재료 공학 기술자 및 시험원'이 가장 적은 월급은 받는 '가사 및 육아 도우미'보다 10배가 넘는 월급을 받음을 알 수 있다.
